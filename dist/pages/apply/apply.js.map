{"version":3,"file":"pages/apply/apply.js","sources":["webpack:///._src_pages_apply_apply.js","webpack:///./src/pages/apply/apply.js?3930","webpack:///._src_pages_apply_apply.scss"],"sourcesContent":["import { Image, View, Form, Input, Textarea, Button } from \"@tarojs/components\"\nimport React from \"react\"\nimport Taro, { chooseInvoiceTitle } from \"@tarojs/taro\"\nimport withWeapp from \"@tarojs/with-weapp\"\nimport \"./apply.scss\"\nimport { getDistanceFromLatLonInKm } from \"../utils/util\"\nimport { formatTime, formatTime1 } from \"../utils/util\"\n/**\n * 报名\n *\n * @author: Eysonyou\n * @create: 2019-05-14\n */\nconst app = Taro.getApp().$app\n\n@withWeapp({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    // 解决textarea组件在表单提交时无法获取内容的BUG\n    resultRows: [],\n    todayCount: 0,\n  },\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function(options) {\n    Taro.setNavigationBarTitle({\n      // title: \"公益排行\",\n      title: \"我的邀请\",\n    })\n    // 当前版本不支持小程序云函数\n    if (!Taro.cloud) {\n      Taro.showModal({\n        title: \"提示\",\n        content: \"微信版本过低，请升级微信\",\n      })\n      return\n    }\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow: function() {\n    let thar = this\n    // 全局显示loading\n    Taro.showLoading({\n      title: \"加载中...\",\n    })\n    // 调用云函数\n    Taro.cloud\n      .callFunction({\n        name: \"queryUser\",\n        data: {\n          env: app.globalData.env,\n        },\n      })\n      .then((res) => {\n        // console.log(res,\"查询用户列表成功\")\n        var rows = res.result ? res.result : []\n        let result1 = []\n        let result2 = []\n        let today = 0\n        rows.map((item) => {\n          // item.distance = getDistanceFromLatLonInKm(\n          //   app.globalData.latitude,\n          //   app.globalData.longitude,\n          //   item.latitude,\n          //   item.longitude\n          // );\n          // if (item.distance <= 3) {\n          //   result1.push(item);\n          // } else {\n          //   result2.push(item);\n          // }\n          if (thar.isToday(item._updateTime)) {\n            ++today\n          }\n        })\n        // rows = [...result1, ...result2];\n        rows.sort(this.compareDate(\"_updateTime\"))\n        // 异步回调并更新数据\n        this.setData({\n          resultRows: rows,\n          todayCount: today,\n          isEmpty: rows.length > 0 ? false : true,\n        })\n        // 隐藏loading\n        Taro.hideLoading()\n      })\n      .catch((err) => {\n        console.log(err, \"call INDEX func err\")\n        Taro.hideLoading()\n        Taro.showModal({\n          title: \"提示\",\n          content: \"系统异常，请稍后再试\",\n        })\n      })\n  },\n\n  compareDate: function(property) {\n    return function(a, b) {\n      var value1 = a[property]\n      var value2 = b[property]\n      return value2 - value1\n    }\n  },\n\n  isToday: function(str) {\n    if (new Date(str).toDateString() === new Date().toDateString()) {\n      //今天\n      return true\n    } else if (new Date(str) < new Date()) {\n      //之前\n      return false\n    }\n  },\n\n  compare: function(property) {\n    return function(a, b) {\n      var value1 = a[property]\n      var value2 = b[property]\n      return value1 - value2\n    }\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide: function() {},\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload: function() {},\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh: function() {},\n\n  /**\n   * 页面上拉触底事件的处理函数\n   */\n  onReachBottom: function() {},\n})\nclass _C extends React.Component {\n  render() {\n    const { resultRows, todayCount } = this.data\n    return (\n      <View className=\"page\" style={{ height: \"100%\" }}>\n        {resultRows.length === 0 ? (\n          <View\n            style={{\n              backgroundColor: \"#FFFFFF\",\n              height: \"100%\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n            }}\n          >\n            暂无数据\n          </View>\n        ) : (\n          <View>\n            <View style={{ padding: \"10px\" }}>\n              <View className=\"weui-media-box__title\">\n                总邀请人数：{resultRows.length}人\n              </View>\n              <View\n                className=\"weui-media-box__desc ui-font-red\"\n                style={{ marginTop: \"10px\" }}\n              >\n                今日活跃：{todayCount}人\n              </View>\n            </View>\n            {resultRows.map((item, index) => {\n              return (\n                item.nickName && (\n                  <View className=\"ui-list-item\" key=\"_id\">\n                    <View style={{ display: \"flex\" }}>\n                      <Image\n                        className=\"weui-uploader__img\"\n                        src={item.avatarUrl}\n                        mode=\"aspectFill\"\n                      ></Image>\n                      <View className=\"weui-media-box__title\">\n                        {item.nickName}\n                      </View>\n                    </View>\n                    <View className=\"weui-media-box__desc\">\n                      {item.score\n                        ? `贡献${item.score}个公益积分`\n                        : `暂未贡献公益积分`}\n                      <View>{formatTime1(new Date(item._updateTime))}</View>\n                    </View>\n                  </View>\n                )\n              )\n            })}\n          </View>\n        )}\n      </View>\n    )\n  }\n}\nexport default _C\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./apply.js\"\nvar config = {\"usingComponents\":{}};\n\n\nvar inst = Page(createPageConfig(component, 'pages/apply/apply', {root:{cn:[]}}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AAuIA;AArIA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAzBA;AACA;AA2BA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AADA;AACA;AAGA;AAEA;AACA;AACA;AADA;AAFA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AACA;AAsBA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AACA;AAIA;AAtCA;AAyCA;AACA;AACA;AACA;AACA;AAFA;AA3CA;AAtCA;AAwFA;AACA;AACA;AACA;AACA;AAHA;AAzFA;AAgGA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAvGA;AA0GA;AACA;AACA;AACA;AACA;AAHA;AA3GA;AACA;AAiHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApIA;;;;;;;;;;;;;AAuIA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AAAA;AAYA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAFA;AAAA;AAJA;AAYA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AANA;AAUA;AAAA;AAIA;AAAA;AAJA;AAXA;AAfA;AAAA;AAdA;AAsDA;;;;AA1DA;AACA;AA2DA;;;;;;;;;;;;;ACjNA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}